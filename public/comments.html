<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realtime comment system</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">




    <link href="videojs.markers.css" rel="stylesheet">
   <link rel="stylesheet" href="styles.css">
   <link rel="stylesheet" href="/css/delete.css">




   <link href="http://vjs.zencdn.net/4.3/video-js.css" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
   <style>
      .card-body{
         border-radius: 10px;
      }
   </style>

</head>
<header class="header-fixed">

   <div class="header-limiter">

   <h1 style="margin-top: 20px;margin-left: 55px;"> <u>Lecture Video-1</u></h1>
       <!-- <img src="https://iitpkd.ac.in/sites/default/files/inline-images/IIT_PKD_long%20logo_RGB.jpg" alt="Girl in a jacket" width="50" height="50"> -->


       <nav>
          
       </nav>

   </div>

</header>

<body>
    <div class="container">





        <p id="smile" style="display: none;">0</p>
        <h id="sm" style="display: none;" >&#129409; : <h id="count">0</h></h>
        <p style="width: 20px;display: none;"><span id='display'></span></p>
     
        <!-- <input type="checkbox" id="r4"><label for="r4" class="react"  style="--r:15px"><i data-icon="üëç"></i></label> -->
     
     
       <div id="videocontainer" class="videoContainer">
     
        <video id="test_video" muted controls preload="none" preferFullWindow="true" class="video-js vjs-default-skin" width="720" height="350" >
           
           <source id="srcvideo" src="images/vid-1.mp4" type="video/mp4">
     
        </video>
        <!-- <video id="test_video" src="images/vid-2.mp4" loop controls class="video-js vjs-default-skin" width="720" height="350"></video> -->
       <div class="moveToVideoJs">
        <div class="advertisement">
           <!-- <button class="advertisement" onclick="openForm()">Comment </button> -->
     
             <div class="form-popup" id="myForm">
                <div class="form-container">


                    <div class="row mb-4">
                        <div class="col-md-12">
                            <h4 class="border-bottom pb-2">Comments</h4>
                        </div>
            
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="">Write a comment</label>
                                <textarea id="textarea" rows="3" class="form-control"></textarea>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <button id="submitBtn" class="btn btn-primary float-right">Post comment</button>
                        </div>
            
                    </div>
                </div>
             </div>
          </div>
      </div>
     
     </div>
     
     <!-- <label>Your input: </label> -->
     
     
     
     
     
     
      
      <!-- <ul style="margin-left: 65%; margin-top: -30%;width: 100px;" id='marker-list'>Reactions :
       
      </ul> -->
     
     
    
     
     
      <!-- <div class='event-list'>
       <div><b>Events: </b></div>
     </div> -->
     <!-- <div class='add'>Add</div> -->
     <ul id='list' style="color: red;">
       <!-- <li> üòÜ: 50</li>
       <li>ok</li>
       <li>good</li> -->
       
     </ul>
     <ul style="margin-left: 0%; margin-top: 25%;width: 390px;">
       
     
     </ul>
     






        <div style="margin-left:750px;margin-top:-627px;height: 352px;width:400px;border:1px solid #ccc;overflow:auto;background-color: white;">

        
            <div style="margin-left: 20px;margin-top: 20px;" class="row">
                <div class="col-md-12">
                    <div class="typing text-success"></div>
                    <ul class="comment__box">
                      
                    </ul>
                </div>
            </div>
        </div>

    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.25.3/moment.min.js"></script>


    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="http://vjs.zencdn.net/4.3/video.js"></script>
    <script src='videojs-markers.js'></script>
</body>


<script>
    // initialize video.js
   var player = videojs('test_video');


var emote=[];
var comment=[];
var timearray=[];
// var emotearray=[{a:0},
//                {b:0},
//                {c:0},
//                {d:0}]
var a,b,c,d=0;
var counter=0

document.getElementById("test_video").addEventListener("loadedmetadata", function() {
   // this.currentTime = 10;
   console.log("okk")
});
// document.getElementsByClassName("vjs-marker")[0].style.color = "blue";


function onloadfun() {
         var time=1552;
      var time_count=time/20;
      two_sec=2
      console.log(time_count)

      for (let i = 0; i < time_count; i++) {
         markers.push({time: two_sec,
                     text: "Chapter"+two_sec})
         two_sec=two_sec+20
      }
   }

//load the marker plugin

var markers = [];



//load the marker plugin
player.markers({
   markerTip:{
      display: true,
      text: function(marker){
         return marker.text;
      }
   },
   breakOverlay:{
      display: true,
      displayTime: 2,
      text: function(marker) {
         return marker.text;
      }
   },
   onMarkerReached: function(marker) {
     console.log(marker);
   },
   markers: markers
});

         var smile=0;
         var smile1=0;
         var smile2=0;
         var smile3=0;
         var j=0;
         var cnt=0;
         var open=0;
         var c=0;
         var com=0

        

///////////////////////////////////emote1
         var myButton = player.controlBar.addChild("button");
         var myButtonDom = myButton.el();
         myButtonDom.innerHTML = '<button class="b1" <span style="font-size:25px;""><input class="emote" type="checkbox" id="r4"><label for="r4" class="react"  style="--r:40px"><i data-icon="üëç"></i></label></span></button>';
         // myButtonDom.innerHTML = '<IMG SRC="sm1.gif" style="width:30px;height:30px;">';
         // myButtonDom.innerHTML = '<input type="checkbox" id="r4"><label for="r4" class="react"  style="--r:30px"><i data-icon="üëç"></i></label>';



         myButtonDom.style.cssText = 'font-size: 18px;';


                     // $(document).ready(function(){
            tt=1
            myButtonDom.onclick = function(){


               //Videoname
               var favoritemovie = sessionStorage.getItem("favoriteMovie");
               var video_name=favoritemovie.slice(29)
               video_name = video_name.slice(0, -4);
               let username = sessionStorage.getItem("id");
               console.log(video_name,username,"VNAMEEEEEE")
               var t=player.currentTime();
               //Fetch
               let data = {

                  username: username,
                  likes:t,
                  video_name:video_name
               }
               const headers = {
                     'Content-Type': 'application/json'
                     }
                  fetch('/saveemote', { method: 'POST', body:JSON.stringify(data),headers})
                     .then(response => response.json())
                     .then(result => {
                           console.log(result)
                           
                     })



            var today = new Date();
            var time1 = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            console.log(time1)

            if(tt1!=time1){

            

               tt1=time1

         
                  var t=player.currentTime();
                  t=Math.trunc(t)
                  console.log(t)


                  if(t%2!=0)
                  {


                     timearray.push({time:t+1,text :"smile"})
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecountodd(timearray,t)

                     // for(let i=0;i<timearray.length;i++)
                     // {
                     //    if(timearray[i].time==t+1 && timearray[i].text=="smile1")counter++;
                     // }

                     console.log('counter',counter)

                     console.log("count",timearray)


                     player.markers.add([{
                           time: t+1,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);

                  }


                  else{

                     timearray.push({time:t+2,text :"smile"})
                     index=timearray.findIndex((obj=>obj.time==t+2))
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecount(timearray,t)

                     console.log('smile',a)

                     console.log("index",index)
                     console.log("count",timearray)

                     player.markers.add([{
                           time: t+2,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);
                  }

                  emote.push({time:player.currentTime(),text :"üëç"+format(Math.trunc(player.currentTime()))})
               cnt++;
               start(cnt);
               }
            
               




             
         } 
       
///////////////////////////emote2
         var myButton1 = player.controlBar.addChild("button");
         var myButtonDom1 = myButton1.el();
         // myButtonDom1.innerHTML = '<IMG class="b1" SRC="doubt1.gif" style="width:30px;height:30px;">';
         // myButtonDom1.innerHTML = '<button class="b1" <span style="font-size:2px;""><input "class="emote" type="checkbox" id="r5"><label for="r5" class="react" style="--r:150px" ><i data-icon="üßê"></i></label></span></button>';
         myButtonDom1.innerHTML = '<button class="b1" <span style="font-size:25px;""><input class="emote" type="checkbox" id="r5"><label for="r5" class="react"  style="--r:40px"><i data-icon="üòÅ"></i></label></span></button>';

         myButtonDom1.style.cssText = 'font-size: 18px;';
         tt1=1
         myButtonDom1.onclick = function(){


            var today = new Date();
            var time1 = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            console.log(time1)

            if(tt1!=time1){

            

               tt1=time1

         
                  var t=player.currentTime();
                  t=Math.trunc(t)
                  console.log(t)


                  if(t%2!=0)
                  {


                     timearray.push({time:t+1,text :"doubt"})
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecountodd(timearray,t)

                     // for(let i=0;i<timearray.length;i++)
                     // {
                     //    if(timearray[i].time==t+1 && timearray[i].text=="smile1")counter++;
                     // }

                     console.log('counter',counter)

                     console.log("count",timearray)


                     player.markers.add([{
                           time: t+1,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);

                  }


                  else{

                     timearray.push({time:t+2,text :"doubt"})
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecount(timearray,t)

                     console.log('doubt',counter)

                     console.log("count",timearray)

                     player.markers.add([{
                           time: t+2,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);
                  }
               
               emote.push({time:player.currentTime(),text :"üòÅ"+format(Math.trunc(player.currentTime()))})
               cnt++;
               start(cnt);
            }

           


             
         } 

////////////////////////////emote3
         var myButton3 = player.controlBar.addChild("button");
         var myButtonDom3 = myButton3.el();
         myButtonDom3.innerHTML = '<button class="b1" <span style="font-size:25px;""><input class="emote" type="checkbox" id="r6"><label for="r6" class="react"  style="--r:40px"><i data-icon="ü§î"></i></label></span></button>';
         myButtonDom3.style.cssText = 'font-size: 18px;';
         myButtonDom3.onclick = function(){

            var today = new Date();
            var time1 = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            console.log(time1)

            if(tt1!=time1){

            

               tt1=time1

         
                  var t=player.currentTime();
                  t=Math.trunc(t)
                  console.log(t)


                  if(t%2!=0)
                  {


                     timearray.push({time:t+1,text :"fever"})
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecountodd(timearray,t)

                     // for(let i=0;i<timearray.length;i++)
                     // {
                     //    if(timearray[i].time==t+1 && timearray[i].text=="smile1")counter++;
                     // }

                     console.log('counter',counter)

                     console.log("count",timearray)


                     player.markers.add([{
                           time: t+1,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);

                  }


                  else{

                     timearray.push({time:t+2,text :"fever"})
                     index=timearray.findIndex((obj=>obj.time==t+2))
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecount(timearray,t)

                     console.log('smile',a)

                     console.log("index",index)
                     console.log("count",timearray)

                     player.markers.add([{
                           time: t+2,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);
                  }
               
               emote.push({time:player.currentTime(),text :"ü§î"+format(Math.trunc(player.currentTime()))})
               cnt++;
               start(cnt);
            }


         } 

//////////////////////////////////emote4
         var myButton4 = player.controlBar.addChild("button");
         var myButtonDom4 = myButton4.el();
         myButtonDom4.innerHTML = '<button class="b1" <span style="font-size:25px;""><input class="emote" type="checkbox" id="r7"><label for="r7" class="react"  style="--r:40px"><i data-icon="üòï"></i></label></span></button>';
         myButtonDom4.style.cssText = 'font-size: 18px;';
         myButtonDom4.onclick = function(){



            var today = new Date();
            var time1 = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            console.log(time1)

            if(tt1!=time1){

            

               tt1=time1

         
                  var t=player.currentTime();
                  t=Math.trunc(t)
                  console.log(t)


                  if(t%2!=0)
                  {


                     timearray.push({time:t+1,text :"sad"})
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecountodd(timearray,t)

                     // for(let i=0;i<timearray.length;i++)
                     // {
                     //    if(timearray[i].time==t+1 && timearray[i].text=="smile1")counter++;
                     // }

                     console.log('counter',counter)

                     console.log("count",timearray)


                     player.markers.add([{
                           time: t+1,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);

                  }


                  else{

                     timearray.push({time:t+2,text :"sad"})
                     index=timearray.findIndex((obj=>obj.time==t+2))
                     counter=0
                     a=0
                     c=0
                     d=0
                     emotecount(timearray,t)

                     console.log('smile',a)

                     console.log("index",index)
                     console.log("count",timearray)

                     player.markers.add([{
                           time: t+2,
                           text: "üëç : " + a +" "+"üòÅ : " + counter + " " + "ü§î : " + c +" " +"üòï :" + d
                        }]);
                  }
               
            
               emote.push({time:player.currentTime(),text :"üòï"+format(Math.trunc(player.currentTime()))})
               cnt++;
               start(cnt);
            }


          
         }







         var myButton2 = player.controlBar.addChild("button");
         var myButtonDom2 = myButton2.el();
         myButtonDom2.innerHTML = '<span class="material-icons">question_answer</span>';
         myButtonDom2.style.cssText = 'font-size: 30px;';
         myButtonDom2.onclick = function(){



         
            openForm();

          
         } 




         function start(s)
         {
            $(document).ready(function(){
            // insert marker list
            // for(var i =s-1; i < emote.length; i++){
               var item = $("<li data-index='"+s+"'><a href='#'>"+emote[s-1].text+"</a></li>");
               $("#marker-list").append(item);
            // }

            // set up click event
            $("#marker-list li").click(function(){
               var index = $(this).data("index");
               console.log(index)

               player.currentTime(emote[index-1].time);
            });

         });
   }

   $(document).ready(function(){
 
$(".moveToVideoJs").appendTo($('#test_video'));
     // show advertisement label while play advertisement
     
     // Stop from seeking while playing advertisement
     
     
     // Hide Advertisement label and change data-src of player to play actual video
     
});

function openForm() {

if (open==0){
   document.getElementById("myForm").style.display = "block";
   open=1

}
else
{
   document.getElementById("myForm").style.display = "none";
   open=0

}


}


function submit()
{
open=0
var cmt=document.getElementById("user_input").value;
console.log("one",cmt)
document.getElementById('display').innerHTML = document.getElementById("user_input").value;

comment.push({time:player.currentTime(),text :cmt+" "+"@"+" "+ format(Math.trunc(player.currentTime()))})
console.log("commnetarray",comment)
console.log("two",comment[0].text)

$(document).ready(function(){
      // insert marker list
            // for(var i =s-1; i < emote.length; i++){
               console.log("okok")
               var item1 = $("<div class=\"tooltip\"><li data-commentindex='"+com+"'><a href='#'>"+comment[com].text+"</a></li><span class=\"tooltiptext\">Clicking this makes you go to the timestamp </span></div>");
               console.log("three",item1)
               $("#marker-list1").append(item1);
            // }
//                <div class="tooltip"><li data-commentindex='"+c+"'><a href='#'>"+comment[c].text+"</a></li>
//    <span class="tooltiptext">Tooltip text</span>
//  </div>
            // set up click event
            $("#marker-list1 li").click(function(){
               var index1 = $(this).data("commentindex");
               console.log(index1)

               player.currentTime(comment[index1].time);
            });
            com++;

         });



document.getElementById("myForm").style.display = "none";

 
}

   

$(document).ready(function(){
   // insert marker list
   for(var i =0; i < markers.length; i++){
      var item = $("<li data-index='"+i+"'><a href='#'>"+markers[i].text+"</a></li>");
      $("#marker-list").append(item);
   }

   // set up click event
   $("#marker-list li").click(function(){
      var index = $(this).data("index");

      player.currentTime(markers[index].time);
   });

});
function format(time) {   
 // Hours, minutes and seconds
 var hrs = ~~(time / 3600);
 var mins = ~~((time % 3600) / 60);
 var secs = ~~time % 60;

 // Output like "1:01" or "4:03:59" or "123:03:59"
 var ret = "";
 if (hrs > 0) {
     ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
 }
 ret += "" + mins + ":" + (secs < 10 ? "0" : "");
 ret += "" + secs;
 return ret;
}

//Facebook Comments Js
function emotecount(timearray,t)
{


   for(let i=0;i<timearray.length;i++)
   {
      if(timearray[i].time==t+2 && timearray[i].text=="doubt")counter++;
      if(timearray[i].time==t+2 && timearray[i].text=="smile")a++;
      if(timearray[i].time==t+2 && timearray[i].text=="fever")c++;
      if(timearray[i].time==t+2 && timearray[i].text=="sad")d++;



   }
   console.log("ttttt",t)

   console.log("smilefun",a)

   // return counter,a,c,d
}
function emotecountodd(timearray,t)
{


   for(let i=0;i<timearray.length;i++)
   {
      if(timearray[i].time==t+1 && timearray[i].text=="doubt")counter++;
      if(timearray[i].time==t+1 && timearray[i].text=="smile")a++;
      if(timearray[i].time==t+1 && timearray[i].text=="fever")c++;
      if(timearray[i].time==t+1 && timearray[i].text=="sad")d++;



   }
   console.log("ttttt",t)

   console.log("smilefun",a)

   // return counter,a,c,d
}

   var favoritemovie = sessionStorage.getItem("favoriteMovie");
   var video_name=favoritemovie.slice(29)
   video_name = video_name.slice(0, -4);

   sessionStorage.setItem("video_name", video_name);

   favoritemovie = favoritemovie.slice(22);
  

   console.log(favoritemovie,video_name,"RESULT");
   //  document.getElementById("movie").innerHTML=favoritemovie  
   document.querySelector('#test_video_html5_api').src = favoritemovie;

 
   // document.querySelector('.videoContainer .video-js .vjs-default-skin').src = favoritemovie;


      
</script>
<script>
   let name = {

   
      video_name:video_name
   }
   console.log(name,"ITSNAME")
   function getOccurrence(array, value) {
    var count = 0;
    array.forEach((v) => (v === value && count++));
    return count;
}
   const headers = {
        'Content-Type': 'application/json'
    }
    fetch('/fetchemote', { method: 'POST', body:JSON.stringify(name),headers})
        .then(response => response.json())
        .then(result => {
            console.log(result)
            function count_duplicate(a){
               let counts = {}

               for(let i =0; i < a.length; i++){ 
                  if (counts[a[i]]){
                  counts[a[i]] += 1
                  } else {
                  counts[a[i]] = 1
                  }
                  }  
                  for (let prop in counts){
                     if (counts[prop] >= 2){
                           // console.log(prop + " counted: " + counts[prop] + " times.")
                     }
                  }
               // console.log(counts)
               return counts
            }
            du=count_duplicate(result)
            console.log(du)
            
            // console.log(Object.entries(du),"ARR")
            var emote_array1= Object.entries(du)
            emote_array1.forEach(e=>{

                  markers.push({time:e[0],text:"üëç : "+e[1]})


            })
            // markers.push({time:element,text:"üëç : "})

               
         

        })
</script>
<script src="/js/app.js"></script>


</html>